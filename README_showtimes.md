# UGC Showtimes Fetcher

A Python script to fetch movie showtimes from UGC using film IDs extracted from the parsed films data.

## Features

- Loads film data from the parsed JSON file (`ugc_films_parsed.json`)
- Fetches available dates for each film using the UGC API
- Retrieves showtimes for specific dates and films
- Extracts cinema information and showtime schedules
- Saves structured showtimes data to JSON format
- Provides detailed summaries and statistics

## API Endpoints Used

The script uses two main UGC API endpoints:

1. **Available Dates Endpoint**:
   ```
   https://www.ugc.fr/showingsFilmAjaxAction!getDaysByFilm.action
   ```
   - Parameters: `filmId`, `day`, `regionId`, `defaultRegionId`
   - Returns: Available dates for a specific film

2. **Showtimes Endpoint**:
   ```
   https://www.ugc.fr/showingsFilmAjaxAction!getShowingsByFilm.action
   ```
   - Parameters: `filmId`, `day`, `regionId`, `defaultRegionId`
   - Returns: Showtimes for a specific film on a specific date

## Setup

### Prerequisites

Make sure you have:
1. The `ugc_films_parsed.json` file (generated by `ugc_films_parser.py`)
2. The required dependencies installed

### Dependencies

The script uses the same dependencies as the parser:
- `requests` - for HTTP requests
- `beautifulsoup4` - for HTML parsing

## Usage

### Basic Usage

```bash
python ugc_showtimes_fetcher.py
```

This will:
1. Load film data from `ugc_films_parsed.json`
2. Fetch showtimes for the first 5 films (configurable)
3. Save the results to `ugc_showtimes.json`
4. Print a summary of the fetched data

### Programmatic Usage

```python
from ugc_showtimes_fetcher import UGCShowtimesFetcher

# Create fetcher instance
fetcher = UGCShowtimesFetcher()

# Load films data
films_data = fetcher.load_films_data('ugc_films_parsed.json')

# Fetch showtimes for all films (limit to 10)
showtimes_data = fetcher.fetch_all_showtimes(films_data, max_films=10)

# Save to file
fetcher.save_showtimes_to_file(showtimes_data, 'my_showtimes.json')

# Print summary
fetcher.print_showtimes_summary(showtimes_data)
```

## Output Structure

The script generates a structured JSON file with the following format:

```json
{
  "metadata": {
    "fetched_at": "2024-01-15T10:30:00.123456",
    "total_films_processed": 5,
    "total_showtimes_found": 45
  },
  "films": {
    "17055": {
      "film_id": "17055",
      "film_title": "DRACULA",
      "date": "2024-01-15",
      "available_dates": ["2024-01-15", "2024-01-16", "2024-01-17"],
      "cinemas": [
        {
          "name": "UGC Ciné Cité Les Halles",
          "showtimes": ["09:15", "10:30", "11:55", "13:20", "14:40"]
        },
        {
          "name": "UGC Ciné Cité Maillot",
          "showtimes": ["12:30", "15:10", "17:50", "20:30"]
        }
      ]
    }
  }
}
```

## Configuration Options

### Region ID

The script uses `regionId=1` by default (Paris region). You can modify this in the code:

```python
# Change region ID for different areas
available_dates = fetcher.get_available_dates(film_id, region_id=2)
showtimes = fetcher.get_showtimes_for_date(film_id, date_str, region_id=2)
```

### Number of Films

Control how many films to process by changing the `max_films` parameter:

```python
# Process only 3 films
showtimes_data = fetcher.fetch_all_showtimes(films_data, max_films=3)

# Process all films (be careful with rate limiting)
showtimes_data = fetcher.fetch_all_showtimes(films_data, max_films=1000)
```

## Rate Limiting

The script includes a 1-second delay between requests to be respectful to UGC's servers. You can adjust this in the `fetch_all_showtimes` method:

```python
# Increase delay to 2 seconds
time.sleep(2)
```

## Error Handling

The script includes comprehensive error handling:
- File not found errors
- Network request failures
- HTML parsing errors
- Missing film IDs

Errors are logged to the console and included in the output data.

## Notes

- The script processes films sequentially to avoid overwhelming the server
- HTML parsing may need adjustments if UGC changes their website structure
- The script is designed to work with the output from `ugc_films_parser.py`
- Showtimes are fetched for the first available date for each film
- Cinema names and showtimes are extracted using regex patterns

## Files Generated

- `ugc_showtimes.json`: Structured showtimes data for all processed films

## Troubleshooting

### No showtimes found
- Check if the film is currently showing
- Verify the region ID is correct
- Ensure the film ID is valid

### Network errors
- Check your internet connection
- Verify the UGC website is accessible
- Consider increasing the delay between requests

### HTML parsing issues
- The UGC website structure may have changed
- Check the actual HTML response to adjust parsing logic 